# GPT Researcher æç¤ºè¯æ–‡æ¡£

æœ¬æ–‡æ¡£åŒ…å«äº† GPT Researcher é¡¹ç›®ä¸­æ‰€æœ‰ä½¿ç”¨çš„æç¤ºè¯ï¼ˆpromptsï¼‰çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ã€‚

## 1. MCP ç›¸å…³æç¤ºè¯

### 1.1 MCP å·¥å…·é€‰æ‹©æç¤ºè¯

```python
@staticmethod
def generate_mcp_tool_selection_prompt(query: str, tools_info: List[Dict], max_tools: int = 3) -> str:
    """
    ç”ŸæˆåŸºäº LLM çš„ MCP å·¥å…·é€‰æ‹©æç¤ºè¯ã€‚
    
    å‚æ•°:
        query: ç ”ç©¶æŸ¥è¯¢
        tools_info: å¯ç”¨å·¥å…·åŠå…¶å…ƒæ•°æ®åˆ—è¡¨
        max_tools: è¦é€‰æ‹©çš„æœ€å¤§å·¥å…·æ•°
        
    è¿”å›:
        str: å·¥å…·é€‰æ‹©æç¤ºè¯
    """
    import json
    
    return f"""ä½ æ˜¯ä¸€ä¸ªç ”ç©¶åŠ©æ‰‹ï¼Œå¸®åŠ©ä¸ºç ”ç©¶æŸ¥è¯¢é€‰æ‹©æœ€ç›¸å…³çš„å·¥å…·ã€‚

ç ”ç©¶æŸ¥è¯¢: "{query}"

å¯ç”¨å·¥å…·:
{json.dumps(tools_info, indent=2)}

ä»»åŠ¡: åˆ†æå·¥å…·å¹¶ä¸ºç»™å®šç ”ç©¶æŸ¥è¯¢é€‰æ‹©æ°å¥½ {max_tools} ä¸ªæœ€ç›¸å…³çš„å·¥å…·ã€‚

é€‰æ‹©æ ‡å‡†:
- é€‰æ‹©èƒ½å¤Ÿæä¾›ä¸ç ”ç©¶æŸ¥è¯¢ç›¸å…³çš„ä¿¡æ¯ã€æ•°æ®æˆ–è§è§£çš„å·¥å…·
- ä¼˜å…ˆé€‰æ‹©èƒ½å¤Ÿæœç´¢ã€æ£€ç´¢æˆ–è®¿é—®ç›¸å…³å†…å®¹çš„å·¥å…·
- è€ƒè™‘ç›¸äº’è¡¥å……çš„å·¥å…·ï¼ˆä¾‹å¦‚ï¼Œä¸åŒçš„æ•°æ®æºï¼‰
- æ’é™¤ä¸ç ”ç©¶ä¸»é¢˜æ˜æ˜¾æ— å…³çš„å·¥å…·

è¿”å›å…·æœ‰ä»¥ä¸‹ç¡®åˆ‡æ ¼å¼çš„ JSON å¯¹è±¡:
{{
  "selected_tools": [
    {{
      "index": 0,
      "name": "å·¥å…·åç§°",
      "relevance_score": 9,
      "reason": "è§£é‡Šè¯¥å·¥å…·ç›¸å…³æ€§çš„è¯¦ç»†åŸå› "
    }}
  ],
  "selection_reasoning": "é€‰æ‹©ç­–ç•¥çš„æ€»ä½“è§£é‡Š"
}}

è¯·æ°å¥½é€‰æ‹© {max_tools} ä¸ªå·¥å…·ï¼ŒæŒ‰ä¸ç ”ç©¶æŸ¥è¯¢çš„ç›¸å…³æ€§æ’åºã€‚
"""
```

### 1.2 MCP ç ”ç©¶æ‰§è¡Œæç¤ºè¯

```python
@staticmethod
def generate_mcp_research_prompt(query: str, selected_tools: List) -> str:
    """
    ç”Ÿæˆä½¿ç”¨é€‰å®šå·¥å…·çš„ MCP ç ”ç©¶æ‰§è¡Œæç¤ºè¯ã€‚
    
    å‚æ•°:
        query: ç ”ç©¶æŸ¥è¯¢
        selected_tools: é€‰å®šçš„ MCP å·¥å…·åˆ—è¡¨
        
    è¿”å›:
        str: ç ”ç©¶æ‰§è¡Œæç¤ºè¯
    """
    # å¤„ç† selected_tools å¯èƒ½æ˜¯å­—ç¬¦ä¸²æˆ–å…·æœ‰ .name å±æ€§çš„å¯¹è±¡çš„æƒ…å†µ
    tool_names = []
    for tool in selected_tools:
        if hasattr(tool, 'name'):
            tool_names.append(tool.name)
        else:
            tool_names.append(str(tool))
    
    return f"""ä½ æ˜¯ä¸€ä¸ªå…·æœ‰ä¸“ä¸šå·¥å…·è®¿é—®æƒé™çš„ç ”ç©¶åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯ç ”ç©¶ä»¥ä¸‹æŸ¥è¯¢å¹¶æä¾›å…¨é¢ã€å‡†ç¡®çš„ä¿¡æ¯ã€‚

ç ”ç©¶æŸ¥è¯¢: "{query}"

è¯´æ˜:
1. ä½¿ç”¨å¯ç”¨å·¥å…·æ”¶é›†å…³äºæŸ¥è¯¢çš„ç›¸å…³ä¿¡æ¯
2. å¦‚æœéœ€è¦ï¼Œè°ƒç”¨å¤šä¸ªå·¥å…·ä»¥è·å¾—å…¨é¢çš„è¦†ç›–
3. å¦‚æœå·¥å…·è°ƒç”¨å¤±è´¥æˆ–è¿”å›ç©ºç»“æœï¼Œè¯·å°è¯•æ›¿ä»£æ–¹æ³•
4. å°½å¯èƒ½ç»¼åˆæ¥è‡ªå¤šä¸ªæ¥æºçš„ä¿¡æ¯
5. ä¸“æ³¨äºç›´æ¥å›ç­”æŸ¥è¯¢çš„äº‹å®æ€§ã€ç›¸å…³ä¿¡æ¯

å¯ç”¨å·¥å…·: {tool_names}

è¯·è¿›è¡Œå½»åº•çš„ç ”ç©¶å¹¶æä¾›ä½ çš„å‘ç°ã€‚æˆ˜ç•¥æ€§åœ°ä½¿ç”¨å·¥å…·æ¥æ”¶é›†æœ€ç›¸å…³å’Œå…¨é¢çš„ä¿¡æ¯ã€‚
"""
```

## 2. æœç´¢æŸ¥è¯¢ç”Ÿæˆæç¤ºè¯

```python
@staticmethod
def generate_search_queries_prompt(
    question: str,
    parent_query: str,
    report_type: str,
    max_iterations: int = 3,
    context: List[Dict[str, Any]] = [],
):
    """ä¸ºç»™å®šé—®é¢˜ç”Ÿæˆæœç´¢æŸ¥è¯¢æç¤ºè¯ã€‚
    å‚æ•°:
        question (str): è¦ç”Ÿæˆæœç´¢æŸ¥è¯¢æç¤ºè¯çš„é—®é¢˜
        parent_query (str): ä¸»è¦é—®é¢˜ï¼ˆä»…å¯¹è¯¦ç»†æŠ¥å‘Šç›¸å…³ï¼‰
        report_type (str): æŠ¥å‘Šç±»å‹
        max_iterations (int): è¦ç”Ÿæˆçš„æœ€å¤§æœç´¢æŸ¥è¯¢æ•°
        context (str): å…·æœ‰å®æ—¶ç½‘ç»œä¿¡æ¯çš„æ›´å¥½ç†è§£ä»»åŠ¡çš„ä¸Šä¸‹æ–‡

    è¿”å›: str: ç»™å®šé—®é¢˜çš„æœç´¢æŸ¥è¯¢æç¤ºè¯
    """

    if (
        report_type == ReportType.DetailedReport.value
        or report_type == ReportType.SubtopicReport.value
    ):
        task = f"{parent_query} - {question}"
    else:
        task = question

    context_prompt = f"""
ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ç ”ç©¶åŠ©æ‰‹ï¼Œä»»åŠ¡æ˜¯ä¸ºä»¥ä¸‹ä»»åŠ¡ç”Ÿæˆæœç´¢æŸ¥è¯¢ä»¥æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼š"{task}"ã€‚
ä¸Šä¸‹æ–‡: {context}

ä½¿ç”¨æ­¤ä¸Šä¸‹æ–‡æ¥é€šçŸ¥å’Œå®Œå–„ä½ çš„æœç´¢æŸ¥è¯¢ã€‚ä¸Šä¸‹æ–‡æä¾›å®æ—¶ç½‘ç»œä¿¡æ¯ï¼Œå¯ä»¥å¸®åŠ©ä½ ç”Ÿæˆæ›´å…·ä½“å’Œç›¸å…³çš„æŸ¥è¯¢ã€‚è€ƒè™‘ä¸Šä¸‹æ–‡ä¸­æåˆ°çš„ä»»ä½•å½“å‰äº‹ä»¶ã€æœ€æ–°å‘å±•æˆ–å¯èƒ½å¢å¼ºæœç´¢æŸ¥è¯¢çš„å…·ä½“ç»†èŠ‚ã€‚
""" if context else ""

    dynamic_example = ", ".join([f'"æŸ¥è¯¢ {i+1}"' for i in range(max_iterations)])

    return f"""ç¼–å†™ {max_iterations} ä¸ªè°·æ­Œæœç´¢æŸ¥è¯¢ï¼Œåœ¨çº¿æœç´¢ä»¥å½¢æˆå¯¹ä»¥ä¸‹ä»»åŠ¡çš„å®¢è§‚æ„è§ï¼š"{task}"

å‡è®¾å½“å‰æ—¥æœŸæ˜¯ {datetime.now(timezone.utc).strftime('%Yå¹´%mæœˆ%dæ—¥')}ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚

{context_prompt}
ä½ å¿…é¡»æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›å­—ç¬¦ä¸²åˆ—è¡¨ï¼š[{dynamic_example}]ã€‚
å“åº”åº”ä»…åŒ…å«åˆ—è¡¨ã€‚
"""
```

## 3. æŠ¥å‘Šç”Ÿæˆæç¤ºè¯

### 3.1 ç ”ç©¶æŠ¥å‘Šæç¤ºè¯

```python
@staticmethod
def generate_report_prompt(
    question: str,
    context,
    report_source: str,
    report_format="apa",
    total_words=1000,
    tone=None,
    language="english",
):
    """ä¸ºç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦ç”ŸæˆæŠ¥å‘Šæç¤ºè¯ã€‚
    å‚æ•°: question (str): è¦ç”ŸæˆæŠ¥å‘Šæç¤ºè¯çš„é—®é¢˜
            research_summary (str): è¦ç”ŸæˆæŠ¥å‘Šæç¤ºè¯çš„ç ”ç©¶æ‘˜è¦
    è¿”å›: str: ç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦çš„æŠ¥å‘Šæç¤ºè¯
    """

    reference_prompt = ""
    if report_source == ReportSource.Web.value:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å†™å‡ºæ‰€æœ‰ä½¿ç”¨çš„æºç½‘å€ä½œä¸ºå‚è€ƒæ–‡çŒ®ï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æºï¼Œæ¯ä¸ªæºåªå†™ä¸€ä¸ªå‚è€ƒæ–‡çŒ®ã€‚
æ¯ä¸ªç½‘å€éƒ½åº”è¯¥è¶…é“¾æ¥ï¼š[ç½‘å€ç½‘ç«™](url)
æ­¤å¤–ï¼Œä½ å¿…é¡»åœ¨æŠ¥å‘Šä¸­å¼•ç”¨ç›¸å…³ç½‘å€çš„ä»»ä½•åœ°æ–¹åŒ…å«è¶…é“¾æ¥ï¼š

ä¾‹å¦‚ï¼šä½œè€…ï¼ŒA. A.ï¼ˆå¹´ï¼Œæœˆæ—¥ï¼‰ã€‚ç½‘é¡µæ ‡é¢˜ã€‚ç½‘ç«™åç§°ã€‚[ç½‘å€ç½‘ç«™](url)
"""
    else:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å†™å‡ºæ‰€æœ‰ä½¿ç”¨çš„æºæ–‡æ¡£åç§°ä½œä¸ºå‚è€ƒæ–‡çŒ®ï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æºï¼Œæ¯ä¸ªæºåªå†™ä¸€ä¸ªå‚è€ƒæ–‡çŒ®ã€‚"
"""

    tone_prompt = f"ä½¿ç”¨ {tone.value} è¯­æ°”æ’°å†™æŠ¥å‘Šã€‚" if tone else ""

    return f"""
ä¿¡æ¯ï¼š"{context}"
---
ä½¿ç”¨ä¸Šè¿°ä¿¡æ¯ï¼Œåœ¨è¯¦ç»†æŠ¥å‘Šä¸­å›ç­”ä»¥ä¸‹æŸ¥è¯¢æˆ–ä»»åŠ¡ï¼š"{question}" --
æŠ¥å‘Šåº”ä¸“æ³¨äºæŸ¥è¯¢çš„ç­”æ¡ˆï¼Œåº”è¯¥ç»“æ„è‰¯å¥½ã€ä¿¡æ¯ä¸°å¯Œã€æ·±å…¥å’Œå…¨é¢ï¼Œå¦‚æœæœ‰äº‹å®å’Œæ•°å­—ï¼Œè‡³å°‘åŒ…å« {total_words} å­—ã€‚
ä½ åº”è¯¥åŠªåŠ›ä½¿ç”¨æä¾›çš„æ‰€æœ‰ç›¸å…³å’Œå¿…è¦ä¿¡æ¯ï¼Œå°½å¯èƒ½é•¿æ—¶é—´åœ°æ’°å†™æŠ¥å‘Šã€‚

è¯·éµå¾ªä»¥ä¸‹æ‰€æœ‰å‡†åˆ™æ’°å†™æŠ¥å‘Šï¼š
- ä½ å¿…é¡»æ ¹æ®ç»™å®šä¿¡æ¯ç¡®å®šè‡ªå·±çš„å…·ä½“æœ‰æ•ˆè§‚ç‚¹ã€‚ä¸è¦æ¨è¿Ÿåˆ°ä¸€èˆ¬å’Œæ— æ„ä¹‰çš„ç»“è®ºã€‚
- ä½ å¿…é¡»ä½¿ç”¨ markdown è¯­æ³•å’Œ {report_format} æ ¼å¼æ’°å†™æŠ¥å‘Šã€‚
- åœ¨å‘ˆç°ç»“æ„åŒ–æ•°æ®æˆ–æ¯”è¾ƒæ—¶ä½¿ç”¨ markdown è¡¨æ ¼ä»¥æé«˜å¯è¯»æ€§ã€‚
- ä½ å¿…é¡»ä¼˜å…ˆè€ƒè™‘æ‰€ä½¿ç”¨æ¥æºçš„ç›¸å…³æ€§ã€å¯é æ€§å’Œé‡è¦æ€§ã€‚é€‰æ‹©å¯ä¿¡æ¥æºè€Œéè¾ƒä¸å¯é çš„æ¥æºã€‚
- å¦‚æœæ¥æºå¯ä¿¡ï¼Œä½ è¿˜å¿…é¡»ä¼˜å…ˆé€‰æ‹©æ–°æ–‡ç« è€Œéæ—§æ–‡ç« ã€‚
- ä½ ä¸å¾—åŒ…å«ç›®å½•ã€‚ç›´æ¥ä»æŠ¥å‘Šä¸»ä½“å¼€å§‹ã€‚
- ä½¿ç”¨ {report_format} æ ¼å¼çš„æ–‡å†…å¼•ç”¨å‚è€ƒæ–‡çŒ®ï¼Œå¹¶ä½¿ç”¨æ”¾åœ¨å¼•ç”¨å®ƒä»¬çš„å¥å­æˆ–æ®µè½æœ«å°¾çš„ markdown è¶…é“¾æ¥ï¼Œåƒè¿™æ ·ï¼š([æ–‡å†…å¼•ç”¨](url))ã€‚
- ä¸è¦å¿˜è®°åœ¨æŠ¥å‘Šæœ«å°¾ä»¥ {report_format} æ ¼å¼æ·»åŠ å‚è€ƒæ–‡çŒ®åˆ—è¡¨å’Œå®Œæ•´çš„ url é“¾æ¥ï¼ˆæ— è¶…é“¾æ¥ï¼‰ã€‚
- {reference_prompt}
- {tone_prompt}

ä½ å¿…é¡»ä½¿ç”¨ä»¥ä¸‹è¯­è¨€æ’°å†™æŠ¥å‘Šï¼š{language}ã€‚
è¯·å°½åŠ›è€Œä¸ºï¼Œè¿™å¯¹æˆ‘çš„èŒä¸šç”Ÿæ¶¯éå¸¸é‡è¦ã€‚
å‡è®¾å½“å‰æ—¥æœŸæ˜¯ {date.today()}ã€‚
"""
```

### 3.2 èµ„æºæŠ¥å‘Šæç¤ºè¯

```python
@staticmethod
def generate_resource_report_prompt(
    question, context, report_source: str, report_format="apa", tone=None, total_words=1000, language="english"
):
    """ä¸ºç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦ç”Ÿæˆèµ„æºæŠ¥å‘Šæç¤ºè¯ã€‚

    å‚æ•°:
        question (str): è¦ç”Ÿæˆèµ„æºæŠ¥å‘Šæç¤ºè¯çš„é—®é¢˜ã€‚
        context (str): è¦ç”Ÿæˆèµ„æºæŠ¥å‘Šæç¤ºè¯çš„ç ”ç©¶æ‘˜è¦ã€‚

    è¿”å›:
        str: ç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦çš„èµ„æºæŠ¥å‘Šæç¤ºè¯ã€‚
    """

    reference_prompt = ""
    if report_source == ReportSource.Web.value:
        reference_prompt = f"""
            ä½ å¿…é¡»åŒ…å«æ‰€æœ‰ç›¸å…³çš„æºç½‘å€ã€‚
            æ¯ä¸ªç½‘å€éƒ½åº”è¯¥è¶…é“¾æ¥ï¼š[ç½‘å€ç½‘ç«™](url)
            """
    else:
        reference_prompt = f"""
            ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å†™å‡ºæ‰€æœ‰ä½¿ç”¨çš„æºæ–‡æ¡£åç§°ä½œä¸ºå‚è€ƒæ–‡çŒ®ï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æºï¼Œæ¯ä¸ªæºåªå†™ä¸€ä¸ªå‚è€ƒæ–‡çŒ®ã€‚
        """

    return (
        f'"""{context}"""\n\nåŸºäºä¸Šè¿°ä¿¡æ¯ï¼Œä¸ºä»¥ä¸‹é—®é¢˜æˆ–ä¸»é¢˜ï¼š"{question}"ç”Ÿæˆæ–‡çŒ®æ¨èæŠ¥å‘Šã€‚'
        f'æŠ¥å‘Šåº”è¯¦ç»†åˆ†ææ¯ä¸ªæ¨èèµ„æºï¼Œè§£é‡Šæ¯ä¸ªèµ„æºå¦‚ä½•æœ‰åŠ©äºæ‰¾åˆ°ç ”ç©¶é—®é¢˜çš„ç­”æ¡ˆã€‚\n'
        "é‡ç‚¹å…³æ³¨æ¯ä¸ªèµ„æºçš„ç›¸å…³æ€§ã€å¯é æ€§å’Œé‡è¦æ€§ã€‚\n"
        "ç¡®ä¿æŠ¥å‘Šç»“æ„è‰¯å¥½ã€ä¿¡æ¯ä¸°å¯Œã€æ·±å…¥ï¼Œå¹¶éµå¾ª Markdown è¯­æ³•ã€‚\n"
        "åœ¨é€‚å½“æ—¶ä½¿ç”¨ markdown è¡¨æ ¼å’Œå…¶ä»–æ ¼å¼åŠŸèƒ½æ¥ç»„ç»‡å’Œæ¸…æ™°åœ°å‘ˆç°ä¿¡æ¯ã€‚\n"
        "åœ¨å¯ç”¨æ—¶åŒ…å«ç›¸å…³çš„äº‹å®ã€æ•°æ®å’Œæ•°å­—ã€‚\n"
        f"æŠ¥å‘Šçš„æœ€å°é•¿åº¦åº”ä¸º {total_words} å­—ã€‚\n"
        f"ä½ å¿…é¡»ä½¿ç”¨ä»¥ä¸‹è¯­è¨€æ’°å†™æŠ¥å‘Šï¼š{language}ã€‚\n"
        "ä½ å¿…é¡»åŒ…å«æ‰€æœ‰ç›¸å…³çš„æºç½‘å€ã€‚"
        "æ¯ä¸ªç½‘å€éƒ½åº”è¯¥è¶…é“¾æ¥ï¼š[ç½‘å€ç½‘ç«™](url)"
        f"{reference_prompt}"
    )
```

### 3.3 å¤§çº²æŠ¥å‘Šæç¤ºè¯

```python
@staticmethod
def generate_outline_report_prompt(
    question, context, report_source: str, report_format="apa", tone=None,  total_words=1000, language: str = "english"
):
    """ä¸ºç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦ç”Ÿæˆå¤§çº²æŠ¥å‘Šæç¤ºè¯ã€‚
    å‚æ•°: question (str): è¦ç”Ÿæˆå¤§çº²æŠ¥å‘Šæç¤ºè¯çš„é—®é¢˜
            research_summary (str): è¦ç”Ÿæˆå¤§çº²æŠ¥å‘Šæç¤ºè¯çš„ç ”ç©¶æ‘˜è¦
    è¿”å›: str: ç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦çš„å¤§çº²æŠ¥å‘Šæç¤ºè¯
    """

    return (
        f'"""{context}""" ä½¿ç”¨ä¸Šè¿°ä¿¡æ¯ï¼Œä¸ºä»¥ä¸‹é—®é¢˜æˆ–ä¸»é¢˜ï¼š"{question}"ç”Ÿæˆç ”ç©¶æŠ¥å‘Šçš„ Markdown è¯­æ³•å¤§çº²ã€‚'
        f'å¤§çº²åº”ä¸ºç ”ç©¶æŠ¥å‘Šæä¾›ç»“æ„è‰¯å¥½çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬ä¸»è¦éƒ¨åˆ†ã€å°èŠ‚å’Œè¦æ¶µç›–çš„è¦ç‚¹ã€‚'
        f"ç ”ç©¶æŠ¥å‘Šåº”è¯¦ç»†ã€ä¿¡æ¯ä¸°å¯Œã€æ·±å…¥ï¼Œæœ€å°‘ {total_words} å­—ã€‚"
        "ä½¿ç”¨é€‚å½“çš„ Markdown è¯­æ³•æ ¼å¼åŒ–å¤§çº²å¹¶ç¡®ä¿å¯è¯»æ€§ã€‚"
        "è€ƒè™‘åœ¨èƒ½å¤Ÿå¢å¼ºä¿¡æ¯å‘ˆç°çš„åœ°æ–¹ä½¿ç”¨ markdown è¡¨æ ¼å’Œå…¶ä»–æ ¼å¼åŠŸèƒ½ã€‚"
    )
```

### 3.4 æ·±åº¦ç ”ç©¶æç¤ºè¯

```python
@staticmethod
def generate_deep_research_prompt(
    question: str,
    context: str,
    report_source: str,
    report_format="apa",
    tone=None,
    total_words=2000,
    language: str = "english"
):
    """ç”Ÿæˆæ·±åº¦ç ”ç©¶æŠ¥å‘Šæç¤ºè¯ï¼Œä¸“é—¨ç”¨äºå¤„ç†åˆ†å±‚ç ”ç©¶ç»“æœã€‚
    å‚æ•°:
        question (str): ç ”ç©¶é—®é¢˜
        context (str): åŒ…å«å¸¦å¼•ç”¨çš„å­¦ä¹ å†…å®¹çš„ç ”ç©¶ä¸Šä¸‹æ–‡
        report_source (str): ç ”ç©¶æ¥æºï¼ˆç½‘ç»œç­‰ï¼‰
        report_format (str): æŠ¥å‘Šæ ¼å¼åŒ–æ ·å¼
        tone: å†™ä½œä¸­ä½¿ç”¨çš„è¯­æ°”
        total_words (int): æœ€å°å­—æ•°
        language (str): è¾“å‡ºè¯­è¨€
    è¿”å›:
        str: æ·±åº¦ç ”ç©¶æŠ¥å‘Šæç¤ºè¯
    """
    reference_prompt = ""
    if report_source == ReportSource.Web.value:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å†™å‡ºæ‰€æœ‰ä½¿ç”¨çš„æºç½‘å€ä½œä¸ºå‚è€ƒæ–‡çŒ®ï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æºï¼Œæ¯ä¸ªæºåªå†™ä¸€ä¸ªå‚è€ƒæ–‡çŒ®ã€‚
æ¯ä¸ªç½‘å€éƒ½åº”è¯¥è¶…é“¾æ¥ï¼š[ç½‘å€ç½‘ç«™](url)
æ­¤å¤–ï¼Œä½ å¿…é¡»åœ¨æŠ¥å‘Šä¸­å¼•ç”¨ç›¸å…³ç½‘å€çš„ä»»ä½•åœ°æ–¹åŒ…å«è¶…é“¾æ¥ï¼š

ä¾‹å¦‚ï¼šä½œè€…ï¼ŒA. A.ï¼ˆå¹´ï¼Œæœˆæ—¥ï¼‰ã€‚ç½‘é¡µæ ‡é¢˜ã€‚ç½‘ç«™åç§°ã€‚[ç½‘å€ç½‘ç«™](url)
"""
    else:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å†™å‡ºæ‰€æœ‰ä½¿ç”¨çš„æºæ–‡æ¡£åç§°ä½œä¸ºå‚è€ƒæ–‡çŒ®ï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æºï¼Œæ¯ä¸ªæºåªå†™ä¸€ä¸ªå‚è€ƒæ–‡çŒ®ã€‚"
"""

    tone_prompt = f"ä½¿ç”¨ {tone.value} è¯­æ°”æ’°å†™æŠ¥å‘Šã€‚" if tone else ""

    return f"""
ä½¿ç”¨ä»¥ä¸‹åˆ†å±‚ç ”ç©¶çš„ä¿¡æ¯å’Œå¼•ç”¨ï¼š

"{context}"

æ’°å†™å›ç­”æŸ¥è¯¢çš„ç»¼åˆç ”ç©¶æŠ¥å‘Šï¼š"{question}"

æŠ¥å‘Šåº”è¯¥ï¼š
1. ç»¼åˆæ¥è‡ªå¤šä¸ªç ”ç©¶æ·±åº¦çš„ä¿¡æ¯
2. æ•´åˆæ¥è‡ªå„ä¸ªç ”ç©¶åˆ†æ”¯çš„å‘ç°
3. å‘ˆç°ä»åŸºç¡€åˆ°é«˜çº§è§è§£çš„è¿è´¯å™è¿°
4. åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒæ­£ç¡®çš„æ¥æºå¼•ç”¨
5. ç»“æ„è‰¯å¥½ï¼Œæœ‰æ¸…æ™°çš„éƒ¨åˆ†å’Œå°èŠ‚
6. æœ€å°é•¿åº¦ä¸º {total_words} å­—
7. éµå¾ª {report_format} æ ¼å¼å’Œ markdown è¯­æ³•
8. åœ¨å‘ˆç°æ¯”è¾ƒæ•°æ®ã€ç»Ÿè®¡æ•°æ®æˆ–ç»“æ„åŒ–ä¿¡æ¯æ—¶ä½¿ç”¨ markdown è¡¨æ ¼ã€åˆ—è¡¨å’Œå…¶ä»–æ ¼å¼åŠŸèƒ½

é¢å¤–è¦æ±‚ï¼š
- ä¼˜å…ˆè€ƒè™‘ä»æ›´æ·±å±‚æ¬¡ç ”ç©¶ä¸­å‡ºç°çš„è§è§£
- çªå‡ºä¸åŒç ”ç©¶åˆ†æ”¯ä¹‹é—´çš„è”ç³»
- åŒ…å«ç›¸å…³çš„ç»Ÿè®¡æ•°æ®ã€æ•°æ®å’Œå…·ä½“ç¤ºä¾‹
- ä½ å¿…é¡»æ ¹æ®ç»™å®šä¿¡æ¯ç¡®å®šè‡ªå·±çš„å…·ä½“æœ‰æ•ˆè§‚ç‚¹ã€‚ä¸è¦æ¨è¿Ÿåˆ°ä¸€èˆ¬å’Œæ— æ„ä¹‰çš„ç»“è®ºã€‚
- ä½ å¿…é¡»ä¼˜å…ˆè€ƒè™‘æ‰€ä½¿ç”¨æ¥æºçš„ç›¸å…³æ€§ã€å¯é æ€§å’Œé‡è¦æ€§ã€‚é€‰æ‹©å¯ä¿¡æ¥æºè€Œéè¾ƒä¸å¯é çš„æ¥æºã€‚
- å¦‚æœæ¥æºå¯ä¿¡ï¼Œä½ è¿˜å¿…é¡»ä¼˜å…ˆé€‰æ‹©æ–°æ–‡ç« è€Œéæ—§æ–‡ç« ã€‚
- ä½¿ç”¨ {report_format} æ ¼å¼çš„æ–‡å†…å¼•ç”¨å‚è€ƒæ–‡çŒ®ï¼Œå¹¶ä½¿ç”¨æ”¾åœ¨å¼•ç”¨å®ƒä»¬çš„å¥å­æˆ–æ®µè½æœ«å°¾çš„ markdown è¶…é“¾æ¥ï¼Œåƒè¿™æ ·ï¼š([æ–‡å†…å¼•ç”¨](url))ã€‚
- {tone_prompt}
- ä½¿ç”¨ {language} å†™ä½œ

{reference_prompt}

è¯·æ’°å†™å½»åº•ã€æ·±å…¥ç ”ç©¶å¥½çš„æŠ¥å‘Šï¼Œå°†æ‰€æœ‰æ”¶é›†çš„ä¿¡æ¯ç»¼åˆæˆä¸€ä¸ªæœ‰å‡èšåŠ›çš„æ•´ä½“ã€‚
å‡è®¾å½“å‰æ—¥æœŸæ˜¯ {datetime.now(timezone.utc).strftime('%Yå¹´%mæœˆ%dæ—¥')}ã€‚
"""
```

### 3.5 è‡ªå®šä¹‰æŠ¥å‘Šæç¤ºè¯

```python
@staticmethod
def generate_custom_report_prompt(
    query_prompt, context, report_source: str, report_format="apa", tone=None, total_words=1000, language: str = "english"
):
    return f'"{context}"\n\n{query_prompt}'
```

## 4. æºç®¡ç†æç¤ºè¯

```python
@staticmethod
def curate_sources(query, sources, max_results=10):
    return f"""ä½ çš„ç›®æ ‡æ˜¯è¯„ä¼°å’Œæ•´ç†ä¸ºç ”ç©¶ä»»åŠ¡æä¾›çš„æŠ“å–å†…å®¹ï¼š"{query}"
åŒæ—¶ä¼˜å…ˆåŒ…å«ç›¸å…³å’Œé«˜è´¨é‡çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯åŒ…å«ç»Ÿè®¡æ•°æ®ã€æ•°å­—æˆ–å…·ä½“æ•°æ®çš„æ¥æºã€‚

æœ€ç»ˆçš„æ•´ç†åˆ—è¡¨å°†ç”¨ä½œåˆ›å»ºç ”ç©¶æŠ¥å‘Šçš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ä¼˜å…ˆè€ƒè™‘ï¼š
- ä¿ç•™å°½å¯èƒ½å¤šçš„åŸå§‹ä¿¡æ¯ï¼Œç‰¹åˆ«å¼ºè°ƒå…·æœ‰å®šé‡æ•°æ®æˆ–ç‹¬ç‰¹è§è§£çš„æ¥æº
- åŒ…å«å¹¿æ³›çš„è§‚ç‚¹å’Œè§è§£
- ä»…è¿‡æ»¤æ‰æ˜æ˜¾æ— å…³æˆ–ä¸å¯ç”¨çš„å†…å®¹

è¯„ä¼°æŒ‡å—ï¼š
1. åŸºäºä»¥ä¸‹æ ‡å‡†è¯„ä¼°æ¯ä¸ªæ¥æºï¼š
   - ç›¸å…³æ€§ï¼šåŒ…å«ç›´æ¥æˆ–éƒ¨åˆ†ä¸ç ”ç©¶æŸ¥è¯¢ç›¸å…³çš„æ¥æºã€‚å€¾å‘äºåŒ…å«ã€‚
   - å¯ä¿¡åº¦ï¼šå€¾å‘äºæƒå¨æ¥æºï¼Œä½†é™¤éæ˜æ˜¾ä¸å¯ä¿¡ï¼Œå¦åˆ™ä¿ç•™å…¶ä»–æ¥æºã€‚
   - æ—¶æ•ˆæ€§ï¼šé™¤éæ—§æ•°æ®æ˜¯å¿…éœ€æˆ–æœ‰ä»·å€¼çš„ï¼Œå¦åˆ™ä¼˜å…ˆé€‰æ‹©æœ€æ–°ä¿¡æ¯ã€‚
   - å®¢è§‚æ€§ï¼šå¦‚æœå®ƒä»¬æä¾›ç‹¬ç‰¹æˆ–è¡¥å……çš„è§‚ç‚¹ï¼Œä¿ç•™æœ‰åè§çš„æ¥æºã€‚
   - å®šé‡ä»·å€¼ï¼šå¯¹å…·æœ‰ç»Ÿè®¡æ•°æ®ã€æ•°å­—æˆ–å…¶ä»–å…·ä½“æ•°æ®çš„æ¥æºç»™äºˆæ›´é«˜ä¼˜å…ˆçº§ã€‚
2. æ¥æºé€‰æ‹©ï¼š
   - åŒ…å«å°½å¯èƒ½å¤šçš„ç›¸å…³æ¥æºï¼Œæœ€å¤š {max_results} ä¸ªï¼Œä¸“æ³¨äºå¹¿æ³›è¦†ç›–å’Œå¤šæ ·æ€§ã€‚
   - ä¼˜å…ˆé€‰æ‹©å…·æœ‰ç»Ÿè®¡æ•°æ®ã€æ•°å­—æ•°æ®æˆ–å¯éªŒè¯äº‹å®çš„æ¥æºã€‚
   - å¦‚æœæ¶‰åŠæ•°æ®ï¼Œé‡å å†…å®¹æ˜¯å¯ä»¥æ¥å—çš„ï¼Œåªè¦å®ƒå¢åŠ æ·±åº¦ã€‚
   - ä»…åœ¨æ¥æºå®Œå…¨æ— å…³ã€ä¸¥é‡è¿‡æ—¶æˆ–ç”±äºå†…å®¹è´¨é‡å·®è€Œæ— æ³•ä½¿ç”¨æ—¶æ‰æ’é™¤ã€‚
3. å†…å®¹ä¿ç•™ï¼š
   - ä¸è¦é‡å†™ã€æ€»ç»“æˆ–å‹ç¼©ä»»ä½•æºå†…å®¹ã€‚
   - ä¿ç•™æ‰€æœ‰å¯ç”¨ä¿¡æ¯ï¼Œä»…æ¸…ç†æ˜æ˜¾çš„åƒåœ¾æˆ–æ ¼å¼é—®é¢˜ã€‚
   - å¦‚æœå®ƒä»¬åŒ…å«æœ‰ä»·å€¼çš„æ•°æ®æˆ–è§è§£ï¼Œä¿ç•™è¾¹ç¼˜ç›¸å…³æˆ–ä¸å®Œæ•´çš„æ¥æºã€‚

è¦è¯„ä¼°çš„æ¥æºåˆ—è¡¨ï¼š
{sources}

ä½ å¿…é¡»ä»¥ä¸åŸå§‹æ¥æºå®Œå…¨ç›¸åŒçš„æ¥æº JSON åˆ—è¡¨æ ¼å¼è¿”å›å“åº”ã€‚
å“åº”ä¸å¾—åŒ…å«ä»»ä½• markdown æ ¼å¼æˆ–é¢å¤–æ–‡æœ¬ï¼ˆå¦‚ ```jsonï¼‰ï¼ŒåªåŒ…å« JSON åˆ—è¡¨ï¼
"""
```

## 5. è‡ªåŠ¨ä»£ç†æŒ‡ä»¤æç¤ºè¯

```python
@staticmethod
def auto_agent_instructions():
    return """
æ­¤ä»»åŠ¡æ¶‰åŠç ”ç©¶ç»™å®šä¸»é¢˜ï¼Œæ— è®ºå…¶å¤æ‚æ€§æˆ–æ˜¯å¦æœ‰æ˜ç¡®ç­”æ¡ˆã€‚ç ”ç©¶ç”±ç‰¹å®šæœåŠ¡å™¨è¿›è¡Œï¼Œç”±å…¶ç±»å‹å’Œè§’è‰²å®šä¹‰ï¼Œæ¯ä¸ªæœåŠ¡å™¨éœ€è¦ä¸åŒçš„æŒ‡ä»¤ã€‚
ä»£ç†
æœåŠ¡å™¨ç”±ä¸»é¢˜é¢†åŸŸå’Œå¯ç”¨äºç ”ç©¶æä¾›ä¸»é¢˜çš„ç‰¹å®šæœåŠ¡å™¨åç§°ç¡®å®šã€‚ä»£ç†æŒ‰å…¶ä¸“ä¸šé¢†åŸŸåˆ†ç±»ï¼Œæ¯ä¸ªæœåŠ¡å™¨ç±»å‹éƒ½ä¸ç›¸åº”çš„è¡¨æƒ…ç¬¦å·ç›¸å…³è”ã€‚

ç¤ºä¾‹ï¼š
ä»»åŠ¡ï¼š"æˆ‘åº”è¯¥æŠ•èµ„è‹¹æœè‚¡ç¥¨å—ï¼Ÿ"
å“åº”ï¼š
{
    "server": "ğŸ’° è´¢åŠ¡ä»£ç†",
    "agent_role_prompt": "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„è´¢åŠ¡åˆ†æå¸ˆ AI åŠ©æ‰‹ã€‚ä½ çš„ä¸»è¦ç›®æ ‡æ˜¯åŸºäºæä¾›çš„æ•°æ®å’Œè¶‹åŠ¿æ’°å†™å…¨é¢ã€æ•é”ã€å…¬æ­£å’Œç³»ç»ŸåŒ–ç»„ç»‡çš„è´¢åŠ¡æŠ¥å‘Šã€‚"
}
ä»»åŠ¡ï¼š"è½¬å”®è¿åŠ¨é‹èƒ½å˜å¾—æœ‰åˆ©å¯å›¾å—ï¼Ÿ"
å“åº”ï¼š
{
    "server":  "ğŸ“ˆ ä¸šåŠ¡åˆ†æå¸ˆä»£ç†",
    "agent_role_prompt": "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ AI ä¸šåŠ¡åˆ†æå¸ˆåŠ©æ‰‹ã€‚ä½ çš„ä¸»è¦ç›®æ ‡æ˜¯åŸºäºæä¾›çš„ä¸šåŠ¡æ•°æ®ã€å¸‚åœºè¶‹åŠ¿å’Œæˆ˜ç•¥åˆ†æï¼Œæ’°å†™å…¨é¢ã€æœ‰æ´å¯ŸåŠ›ã€å…¬æ­£å’Œç³»ç»ŸåŒ–ç»„ç»‡çš„ä¸šåŠ¡æŠ¥å‘Šã€‚"
}
ä»»åŠ¡ï¼š"ç‰¹æ‹‰ç»´å¤«æœ€æœ‰è¶£çš„æ™¯ç‚¹æœ‰å“ªäº›ï¼Ÿ"
å“åº”ï¼š
{
    "server":  "ğŸŒ æ—…è¡Œä»£ç†",
    "agent_role_prompt": "ä½ æ˜¯ä¸€ä½å‘¨æ¸¸ä¸–ç•Œçš„ AI æ—…è¡Œå¯¼æ¸¸åŠ©æ‰‹ã€‚ä½ çš„ä¸»è¦ç›®çš„æ˜¯åœ¨ç»™å®šä½ç½®æ’°å†™å¼•äººå…¥èƒœã€æœ‰æ´å¯ŸåŠ›ã€å…¬æ­£å’Œç»“æ„è‰¯å¥½çš„æ—…è¡ŒæŠ¥å‘Šï¼ŒåŒ…æ‹¬å†å²ã€æ™¯ç‚¹å’Œæ–‡åŒ–è§è§£ã€‚"
}
"""
```

## 6. æ‘˜è¦ç”Ÿæˆæç¤ºè¯

```python
@staticmethod
def generate_summary_prompt(query, data):
    """ä¸ºç»™å®šé—®é¢˜å’Œæ–‡æœ¬ç”Ÿæˆæ‘˜è¦æç¤ºè¯ã€‚
    å‚æ•°: question (str): è¦ç”Ÿæˆæ‘˜è¦æç¤ºè¯çš„é—®é¢˜
            text (str): è¦ç”Ÿæˆæ‘˜è¦æç¤ºè¯çš„æ–‡æœ¬
    è¿”å›: str: ç»™å®šé—®é¢˜å’Œæ–‡æœ¬çš„æ‘˜è¦æç¤ºè¯
    """

    return (
        f'{data}\n ä½¿ç”¨ä¸Šè¿°æ–‡æœ¬ï¼ŒåŸºäºä»¥ä¸‹ä»»åŠ¡æˆ–æŸ¥è¯¢å¯¹å…¶è¿›è¡Œæ‘˜è¦ï¼š"{query}"ã€‚\n å¦‚æœ '
        f"æŸ¥è¯¢æ— æ³•ä½¿ç”¨æ–‡æœ¬å›ç­”ï¼Œä½ å¿…é¡»ç®€çŸ­åœ°æ€»ç»“æ–‡æœ¬ã€‚\n å¦‚æœå¯ç”¨ï¼ŒåŒ…æ‹¬æ‰€æœ‰äº‹å®æ€§"
        f"ä¿¡æ¯ï¼Œå¦‚æ•°å­—ã€ç»Ÿè®¡ã€å¼•ç”¨ç­‰ã€‚"
    )
```

## 7. è¯¦ç»†æŠ¥å‘Šæç¤ºè¯

### 7.1 å­ä¸»é¢˜ç”Ÿæˆæç¤ºè¯

```python
@staticmethod
def generate_subtopics_prompt() -> str:
    return """
æä¾›ä¸»è¦ä¸»é¢˜ï¼š

{task}

å’Œç ”ç©¶æ•°æ®ï¼š

{data}

- æ„å»ºå­ä¸»é¢˜åˆ—è¡¨ï¼ŒæŒ‡ç¤ºè¦åœ¨ä»»åŠ¡ä¸Šç”Ÿæˆçš„æŠ¥å‘Šæ–‡æ¡£çš„æ ‡é¢˜ã€‚
- è¿™äº›æ˜¯å¯èƒ½çš„å­ä¸»é¢˜åˆ—è¡¨ï¼š{subtopics}ã€‚
- ä¸åº”æœ‰ä»»ä½•é‡å¤çš„å­ä¸»é¢˜ã€‚
- å°†å­ä¸»é¢˜æ•°é‡é™åˆ¶åœ¨æœ€å¤š {max_subtopics}
- æœ€åæŒ‰ä»»åŠ¡å¯¹å­ä¸»é¢˜æ’åºï¼Œä»¥ç›¸å…³ä¸”æœ‰æ„ä¹‰çš„é¡ºåºå‘ˆç°ï¼Œåœ¨è¯¦ç»†æŠ¥å‘Šä¸­å¯å±•ç¤º

"é‡è¦ï¼"ï¼š
- æ¯ä¸ªå­ä¸»é¢˜å¿…é¡»ä¸ä¸»è¦ä¸»é¢˜å’Œæä¾›çš„ç ”ç©¶æ•°æ®ç›¸å…³ï¼

{format_instructions}
"""
```

### 7.2 å­ä¸»é¢˜æŠ¥å‘Šæç¤ºè¯

```python
@staticmethod
def generate_subtopic_report_prompt(
    current_subtopic,
    existing_headers: list,
    relevant_written_contents: list,
    main_topic: str,
    context,
    report_format: str = "apa",
    max_subsections=5,
    total_words=800,
    tone: Tone = Tone.Objective,
    language: str = "english",
) -> str:
    return f"""
ä¸Šä¸‹æ–‡ï¼š
"{context}"

ä¸»è¦ä¸»é¢˜å’Œå­ä¸»é¢˜ï¼š
ä½¿ç”¨æœ€æ–°å¯ç”¨ä¿¡æ¯ï¼Œåœ¨ä¸»è¦ä¸»é¢˜ï¼š{main_topic} ä¸‹æ„å»ºå…³äºå­ä¸»é¢˜ï¼š{current_subtopic} çš„è¯¦ç»†æŠ¥å‘Šã€‚
ä½ å¿…é¡»å°†å°èŠ‚æ•°é‡é™åˆ¶åœ¨æœ€å¤š {max_subsections}ã€‚

å†…å®¹ç„¦ç‚¹ï¼š
- æŠ¥å‘Šåº”ä¸“æ³¨äºå›ç­”é—®é¢˜ï¼Œç»“æ„è‰¯å¥½ã€ä¿¡æ¯ä¸°å¯Œã€æ·±å…¥ï¼Œå¹¶åœ¨å¯ç”¨æ—¶åŒ…å«äº‹å®å’Œæ•°å­—ã€‚
- ä½¿ç”¨ markdown è¯­æ³•å¹¶éµå¾ª {report_format.upper()} æ ¼å¼ã€‚
- åœ¨å‘ˆç°æ•°æ®ã€æ¯”è¾ƒæˆ–ç»“æ„åŒ–ä¿¡æ¯æ—¶ï¼Œä½¿ç”¨ markdown è¡¨æ ¼æé«˜å¯è¯»æ€§ã€‚

é‡è¦ï¼šå†…å®¹å’Œéƒ¨åˆ†å”¯ä¸€æ€§ï¼š
- æœ¬éƒ¨åˆ†æŒ‡ä»¤å¯¹äºç¡®ä¿å†…å®¹å”¯ä¸€ä¸”ä¸ä¸ç°æœ‰æŠ¥å‘Šé‡å è‡³å…³é‡è¦ã€‚
- åœ¨ç¼–å†™ä»»ä½•æ–°çš„å°èŠ‚ä¹‹å‰ï¼Œä»”ç»†æŸ¥çœ‹ä¸‹é¢æä¾›çš„ç°æœ‰æ ‡é¢˜å’Œç°æœ‰ä¹¦é¢å†…å®¹ã€‚
- é˜²æ­¢ä»»ä½•å·²åœ¨ç°æœ‰ä¹¦é¢å†…å®¹ä¸­æ¶µç›–çš„å†…å®¹ã€‚
- ä¸è¦ä½¿ç”¨ä»»ä½•ç°æœ‰æ ‡é¢˜ä½œä¸ºæ–°çš„å°èŠ‚æ ‡é¢˜ã€‚
- ä¸è¦é‡å¤å·²åœ¨ç°æœ‰ä¹¦é¢å†…å®¹ä¸­æ¶µç›–çš„ä»»ä½•ä¿¡æ¯æˆ–å¯†åˆ‡ç›¸å…³çš„å˜ä½“ä»¥é¿å…é‡å¤ã€‚
- å¦‚æœä½ æœ‰åµŒå¥—çš„å°èŠ‚ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æœªåœ¨ç°æœ‰ä¹¦é¢å†…å®¹ä¸­æ¶µç›–ã€‚
- ç¡®ä¿ä½ çš„å†…å®¹å®Œå…¨æ˜¯æ–°çš„ï¼Œä¸ä¸å…ˆå‰å­ä¸»é¢˜æŠ¥å‘Šä¸­å·²æ¶µç›–çš„ä»»ä½•ä¿¡æ¯é‡å ã€‚

"ç°æœ‰å­ä¸»é¢˜æŠ¥å‘Š"ï¼š
- ç°æœ‰å­ä¸»é¢˜æŠ¥å‘ŠåŠå…¶éƒ¨åˆ†æ ‡é¢˜ï¼š

    {existing_headers}

- æ¥è‡ªå…ˆå‰å­ä¸»é¢˜æŠ¥å‘Šçš„ç°æœ‰ä¹¦é¢å†…å®¹ï¼š

    {relevant_written_contents}

"ç»“æ„å’Œæ ¼å¼åŒ–"ï¼š
- ç”±äºæ­¤å­æŠ¥å‘Šå°†æ˜¯è¾ƒå¤§æŠ¥å‘Šçš„ä¸€éƒ¨åˆ†ï¼Œä»…åŒ…å«åˆ†ä¸ºåˆé€‚å­ä¸»é¢˜çš„ä¸»ä½“ï¼Œæ²¡æœ‰ä»»ä½•å¼•è¨€æˆ–ç»“è®ºéƒ¨åˆ†ã€‚

- ä½ å¿…é¡»åœ¨æŠ¥å‘Šä¸­å¼•ç”¨ç›¸å…³æºç½‘å€çš„ä»»ä½•åœ°æ–¹åŒ…å« markdown è¶…é“¾æ¥ï¼Œä¾‹å¦‚ï¼š

    ### éƒ¨åˆ†æ ‡é¢˜

    è¿™æ˜¯ç¤ºä¾‹æ–‡æœ¬ï¼ˆ[æ–‡å†…å¼•ç”¨](url)ï¼‰ã€‚

- ä½¿ç”¨ H2 ä½œä¸ºä¸»è¦å­ä¸»é¢˜æ ‡é¢˜ï¼ˆ##ï¼‰å’Œ H3 ä½œä¸ºå°èŠ‚ï¼ˆ###ï¼‰ã€‚
- ä½¿ç”¨è¾ƒå°çš„ Markdown æ ‡é¢˜ï¼ˆä¾‹å¦‚ï¼ŒH2 æˆ– H3ï¼‰è¿›è¡Œå†…å®¹ç»“æ„ï¼Œé¿å…ä½¿ç”¨æœ€å¤§æ ‡é¢˜ï¼ˆH1ï¼‰ï¼Œå› ä¸ºå®ƒå°†ç”¨äºè¾ƒå¤§æŠ¥å‘Šçš„æ ‡é¢˜ã€‚
- å°†ä½ çš„å†…å®¹ç»„ç»‡æˆä¸ç°æœ‰æŠ¥å‘Šäº’è¡¥ä½†ä¸é‡å çš„ä¸åŒéƒ¨åˆ†ã€‚
- åœ¨å‘æŠ¥å‘Šä¸­æ·»åŠ ç›¸ä¼¼æˆ–ç›¸åŒçš„å°èŠ‚æ—¶ï¼Œä½ åº”è¯¥æ¸…æ¥šæŒ‡å‡ºæ–°å†…å®¹ä¸å…ˆå‰å­ä¸»é¢˜æŠ¥å‘Šçš„ç°æœ‰ä¹¦é¢å†…å®¹ä¹‹é—´çš„å·®å¼‚ã€‚ä¾‹å¦‚ï¼š

    ### æ–°æ ‡é¢˜ï¼ˆç±»ä¼¼äºç°æœ‰æ ‡é¢˜ï¼‰

    è™½ç„¶å‰ä¸€èŠ‚è®¨è®ºäº†[ä¸»é¢˜ A]ï¼Œä½†æœ¬èŠ‚å°†æ¢è®¨[ä¸»é¢˜ B]ã€‚

"æ—¥æœŸ"ï¼š
å‡è®¾å½“å‰æ—¥æœŸæ˜¯ {datetime.now(timezone.utc).strftime('%Yå¹´%mæœˆ%dæ—¥')}ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚

"é‡è¦ï¼"ï¼š
- ä½ å¿…é¡»ä½¿ç”¨ä»¥ä¸‹è¯­è¨€æ’°å†™æŠ¥å‘Šï¼š{language}ã€‚
- ç„¦ç‚¹å¿…é¡»é›†ä¸­åœ¨ä¸»è¦ä¸»é¢˜ä¸Šï¼ä½ å¿…é¡»æ’é™¤ä»»ä½•ä¸å®ƒæ— å…³çš„ä¿¡æ¯ï¼
- ä¸å¾—æœ‰ä»»ä½•å¼•è¨€ã€ç»“è®ºã€æ‘˜è¦æˆ–å‚è€ƒæ–‡çŒ®éƒ¨åˆ†ã€‚
- ä½ å¿…é¡»ä½¿ç”¨ {report_format.upper()} æ ¼å¼çš„æ–‡å†…å¼•ç”¨å‚è€ƒæ–‡çŒ®ï¼Œå¹¶ä½¿ç”¨æ”¾åœ¨å¼•ç”¨å®ƒä»¬çš„å¥å­æˆ–æ®µè½æœ«å°¾çš„ markdown è¶…é“¾æ¥ï¼Œåƒè¿™æ ·ï¼š([æ–‡å†…å¼•ç”¨](url))ã€‚
- å¦‚æœå¿…è¦ï¼Œä½ å¿…é¡»åœ¨æŠ¥å‘Šä¸­æ·»åŠ ç›¸ä¼¼æˆ–ç›¸åŒçš„å°èŠ‚æ—¶æåŠç°æœ‰å†…å®¹å’Œæ–°å†…å®¹ä¹‹é—´çš„å·®å¼‚ã€‚
- æŠ¥å‘Šçš„æœ€å°é•¿åº¦åº”ä¸º {total_words} å­—ã€‚
- åœ¨æ•´ä¸ªæŠ¥å‘Šä¸­ä½¿ç”¨ {tone.value} è¯­æ°”ã€‚

ä¸è¦æ·»åŠ ç»“è®ºéƒ¨åˆ†ã€‚
"""
```

### 7.3 è‰ç¨¿æ ‡é¢˜ç”Ÿæˆæç¤ºè¯

```python
@staticmethod
def generate_draft_titles_prompt(
    current_subtopic: str,
    main_topic: str,
    context: str,
    max_subsections: int = 5
) -> str:
    return f"""
"ä¸Šä¸‹æ–‡"ï¼š
"{context}"

"ä¸»è¦ä¸»é¢˜å’Œå­ä¸»é¢˜"ï¼š
ä½¿ç”¨æœ€æ–°å¯ç”¨ä¿¡æ¯ï¼Œä¸ºä¸»è¦ä¸»é¢˜ï¼š{main_topic} ä¸‹çš„å­ä¸»é¢˜ï¼š{current_subtopic} æ„å»ºè¯¦ç»†æŠ¥å‘Šçš„è‰ç¨¿éƒ¨åˆ†æ ‡é¢˜æ ‡é¢˜ã€‚

"ä»»åŠ¡"ï¼š
1. ä¸ºå­ä¸»é¢˜æŠ¥å‘Šåˆ›å»ºè‰ç¨¿éƒ¨åˆ†æ ‡é¢˜æ ‡é¢˜åˆ—è¡¨ã€‚
2. æ¯ä¸ªæ ‡é¢˜åº”ç®€æ´ä¸”ä¸å­ä¸»é¢˜ç›¸å…³ã€‚
3. æ ‡é¢˜ä¸åº”å¤ªé«˜çº§ï¼Œä½†åº”è¶³å¤Ÿè¯¦ç»†ä»¥æ¶µç›–å­ä¸»é¢˜çš„ä¸»è¦æ–¹é¢ã€‚
4. ä½¿ç”¨ markdown è¯­æ³•ä½œä¸ºæ ‡é¢˜ï¼Œä½¿ç”¨ H3ï¼ˆ###ï¼‰ï¼Œå› ä¸º H1 å’Œ H2 å°†ç”¨äºè¾ƒå¤§æŠ¥å‘Šçš„æ ‡é¢˜ã€‚
5. ç¡®ä¿æ ‡é¢˜æ¶µç›–å­ä¸»é¢˜çš„ä¸»è¦æ–¹é¢ã€‚

"ç»“æ„å’Œæ ¼å¼åŒ–"ï¼š
ä½¿ç”¨ markdown è¯­æ³•ä»¥åˆ—è¡¨æ ¼å¼æä¾›è‰ç¨¿æ ‡é¢˜ï¼Œä¾‹å¦‚ï¼š

### æ ‡é¢˜ 1
### æ ‡é¢˜ 2
### æ ‡é¢˜ 3

"é‡è¦ï¼"ï¼š
- ç„¦ç‚¹å¿…é¡»é›†ä¸­åœ¨ä¸»è¦ä¸»é¢˜ä¸Šï¼ä½ å¿…é¡»æ’é™¤ä»»ä½•ä¸å®ƒæ— å…³çš„ä¿¡æ¯ï¼
- ä¸å¾—æœ‰ä»»ä½•å¼•è¨€ã€ç»“è®ºã€æ‘˜è¦æˆ–å‚è€ƒæ–‡çŒ®éƒ¨åˆ†ã€‚
- ä¸“æ³¨äºåˆ›å»ºæ ‡é¢˜ï¼Œè€Œä¸æ˜¯å†…å®¹ã€‚
"""
```

### 7.4 æŠ¥å‘Šå¼•è¨€ç”Ÿæˆæç¤ºè¯

```python
@staticmethod
def generate_report_introduction(question: str, research_summary: str = "", language: str = "english", report_format: str = "apa") -> str:
    return f"""{research_summary}\n
ä½¿ç”¨ä¸Šè¿°æœ€æ–°ä¿¡æ¯ï¼Œä¸ºä¸»é¢˜ -- {question} å‡†å¤‡è¯¦ç»†çš„æŠ¥å‘Šå¼•è¨€ã€‚
- å¼•è¨€åº”ç®€æ´ã€ç»“æ„è‰¯å¥½ã€ä¿¡æ¯ä¸°å¯Œï¼Œä½¿ç”¨ markdown è¯­æ³•ã€‚
- ç”±äºæ­¤å¼•è¨€å°†æ˜¯è¾ƒå¤§æŠ¥å‘Šçš„ä¸€éƒ¨åˆ†ï¼Œä¸è¦åŒ…å«æŠ¥å‘Šä¸­é€šå¸¸å­˜åœ¨çš„ä»»ä½•å…¶ä»–éƒ¨åˆ†ã€‚
- å¼•è¨€åº”ä»¥é€‚åˆæ•´ä¸ªæŠ¥å‘Šçš„ H1 æ ‡é¢˜å¼€å¤´ã€‚
- ä½ å¿…é¡»ä½¿ç”¨ {report_format.upper()} æ ¼å¼çš„æ–‡å†…å¼•ç”¨å‚è€ƒæ–‡çŒ®ï¼Œå¹¶ä½¿ç”¨æ”¾åœ¨å¼•ç”¨å®ƒä»¬çš„å¥å­æˆ–æ®µè½æœ«å°¾çš„ markdown è¶…é“¾æ¥ï¼Œåƒè¿™æ ·ï¼š([æ–‡å†…å¼•ç”¨](url))ã€‚
å‡è®¾å½“å‰æ—¥æœŸæ˜¯ {datetime.now(timezone.utc).strftime('%Yå¹´%mæœˆ%dæ—¥')}ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚
- è¾“å‡ºå¿…é¡»æ˜¯ {language} è¯­è¨€ã€‚
"""
```

### 7.5 æŠ¥å‘Šç»“è®ºç”Ÿæˆæç¤ºè¯

```python
@staticmethod
def generate_report_conclusion(query: str, report_content: str, language: str = "english", report_format: str = "apa") -> str:
    """
    ç”Ÿæˆç®€æ´çš„ç»“è®ºï¼Œæ€»ç»“ç ”ç©¶æŠ¥å‘Šçš„ä¸»è¦å‘ç°å’Œå½±å“ã€‚

    å‚æ•°:
        query (str): ç ”ç©¶ä»»åŠ¡æˆ–é—®é¢˜ã€‚
        report_content (str): ç ”ç©¶æŠ¥å‘Šçš„å†…å®¹ã€‚
        language (str): ç»“è®ºåº”æ’°å†™çš„è¯­è¨€ã€‚

    è¿”å›:
        str: æ€»ç»“æŠ¥å‘Šä¸»è¦å‘ç°å’Œå½±å“çš„ç®€æ´ç»“è®ºã€‚
    """
    prompt = f"""
    åŸºäºä»¥ä¸‹ç ”ç©¶æŠ¥å‘Šå’Œç ”ç©¶ä»»åŠ¡ï¼Œè¯·æ’°å†™ç®€æ´çš„ç»“è®ºï¼Œæ€»ç»“ä¸»è¦å‘ç°åŠå…¶å½±å“ï¼š

    ç ”ç©¶ä»»åŠ¡ï¼š{query}

    ç ”ç©¶æŠ¥å‘Šï¼š{report_content}

    ä½ çš„ç»“è®ºåº”è¯¥ï¼š
    1. å›é¡¾ç ”ç©¶è¦ç‚¹
    2. çªå‡ºæœ€é‡è¦çš„å‘ç°
    3. è®¨è®ºä»»ä½•å½±å“æˆ–åç»­æ­¥éª¤
    4. é•¿åº¦çº¦ 2-3 æ®µ

    å¦‚æœæŠ¥å‘Šæœ«å°¾æ²¡æœ‰å†™å…¥"## ç»“è®º"éƒ¨åˆ†æ ‡é¢˜ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°ä½ çš„ç»“è®ºé¡¶éƒ¨ã€‚
    ä½ å¿…é¡»ä½¿ç”¨ {report_format.upper()} æ ¼å¼çš„æ–‡å†…å¼•ç”¨å‚è€ƒæ–‡çŒ®ï¼Œå¹¶ä½¿ç”¨æ”¾åœ¨å¼•ç”¨å®ƒä»¬çš„å¥å­æˆ–æ®µè½æœ«å°¾çš„ markdown è¶…é“¾æ¥ï¼Œåƒè¿™æ ·ï¼š([æ–‡å†…å¼•ç”¨](url))ã€‚

    é‡è¦ï¼šæ•´ä¸ªç»“è®ºå¿…é¡»ä½¿ç”¨ {language} è¯­è¨€æ’°å†™ã€‚

    æ’°å†™ç»“è®ºï¼š
    """

    return prompt
```

## 8. æ–‡æ¡£å¤„ç†å·¥å…·æ–¹æ³•

### 8.1 æ–‡æ¡£ç¾å¼æ‰“å°

```python
@staticmethod
def pretty_print_docs(docs: list[Document], top_n: int | None = None) -> str:
    """å°†æ–‡æ¡£åˆ—è¡¨å‹ç¼©ä¸ºä¸Šä¸‹æ–‡å­—ç¬¦ä¸²"""
    return f"\n".join(f"æ¥æºï¼š{d.metadata.get('source')}\n"
                      f"æ ‡é¢˜ï¼š{d.metadata.get('title')}\n"
                      f"å†…å®¹ï¼š{d.page_content}\n"
                      for i, d in enumerate(docs)
                      if top_n is None or i < top_n)
```

### 8.2 æœ¬åœ°ç½‘ç»œæ–‡æ¡£è¿æ¥

```python
@staticmethod
def join_local_web_documents(docs_context: str, web_context: str) -> str:
    """å°†æœ¬åœ°ç½‘ç»œæ–‡æ¡£ä¸ä»äº’è”ç½‘æŠ“å–çš„ä¸Šä¸‹æ–‡è¿æ¥"""
    return f"æ¥è‡ªæœ¬åœ°æ–‡æ¡£çš„ä¸Šä¸‹æ–‡ï¼š{docs_context}\n\næ¥è‡ªç½‘ç»œæ¥æºçš„ä¸Šä¸‹æ–‡ï¼š{web_context}"
```

## 9. IBM Granite æ¨¡å‹ç‰¹å®šæç¤ºè¯

### 9.1 Granite 3.X æ¨¡å‹æç¤ºè¯

```python
class Granite3PromptFamily(PromptFamily):
    """IBM granite 3.X æ¨¡å‹çš„æç¤ºè¯ï¼ˆ3.3 ä¹‹å‰ï¼‰"""

    _DOCUMENTS_PREFIX = "<|start_of_role|>documents<|end_of_role|>\n"
    _DOCUMENTS_SUFFIX = "\n<|end_of_text|>"

    @classmethod
    def pretty_print_docs(cls, docs: list[Document], top_n: int | None = None) -> str:
        if not docs:
            return ""
        all_documents = "\n\n".join([
            f"Document {doc.metadata.get('source', i)}\n" + \
            f"Title: {doc.metadata.get('title')}\n" + \
            doc.page_content
            for i, doc in enumerate(docs)
            if top_n is None or i < top_n
        ])
        return "".join([cls._DOCUMENTS_PREFIX, all_documents, cls._DOCUMENTS_SUFFIX])

    @classmethod
    def join_local_web_documents(cls, docs_context: str | list, web_context: str | list) -> str:
        """ä½¿ç”¨ Granite çš„é¦–é€‰æ ¼å¼è¿æ¥æœ¬åœ°ç½‘ç»œæ–‡æ¡£"""
        if isinstance(docs_context, str) and docs_context.startswith(cls._DOCUMENTS_PREFIX):
            docs_context = docs_context[len(cls._DOCUMENTS_PREFIX):]
        if isinstance(web_context, str) and web_context.endswith(cls._DOCUMENTS_SUFFIX):
            web_context = web_context[:-len(cls._DOCUMENTS_SUFFIX)]
        all_documents = "\n\n".join([docs_context, web_context])
        return "".join([cls._DOCUMENTS_PREFIX, all_documents, cls._DOCUMENTS_SUFFIX])
```

### 9.2 Granite 3.3 æ¨¡å‹æç¤ºè¯

```python
class Granite33PromptFamily(PromptFamily):
    """IBM granite 3.3 æ¨¡å‹çš„æç¤ºè¯"""

    _DOCUMENT_TEMPLATE = """<|start_of_role|>document {{"document_id": "{document_id}"}}<|end_of_role|>
{document_content}<|end_of_text|>
"""

    @staticmethod
    def _get_content(doc: Document) -> str:
        doc_content = doc.page_content
        if title := doc.metadata.get("title"):
            doc_content = f"Title: {title}\n{doc_content}"
        return doc_content.strip()

    @classmethod
    def pretty_print_docs(cls, docs: list[Document], top_n: int | None = None) -> str:
        return "\n".join([
            cls._DOCUMENT_TEMPLATE.format(
                document_id=doc.metadata.get("source", i),
                document_content=cls._get_content(doc),
            )
            for i, doc in enumerate(docs)
            if top_n is None or i < top_n
        ])

    @classmethod
    def join_local_web_documents(cls, docs_context: str | list, web_context: str | list) -> str:
        """ä½¿ç”¨ Granite çš„é¦–é€‰æ ¼å¼è¿æ¥æœ¬åœ°ç½‘ç»œæ–‡æ¡£"""
        return "\n\n".join([docs_context, web_context])
```

## 10. æç¤ºè¯å·¥å‚æ˜ å°„

### 10.1 æŠ¥å‘Šç±»å‹æ˜ å°„

```python
report_type_mapping = {
    ReportType.ResearchReport.value: "generate_report_prompt",           # ç ”ç©¶æŠ¥å‘Š
    ReportType.ResourceReport.value: "generate_resource_report_prompt",   # èµ„æºæŠ¥å‘Š
    ReportType.OutlineReport.value: "generate_outline_report_prompt",     # å¤§çº²æŠ¥å‘Š
    ReportType.CustomReport.value: "generate_custom_report_prompt",       # è‡ªå®šä¹‰æŠ¥å‘Š
    ReportType.SubtopicReport.value: "generate_subtopic_report_prompt", # å­ä¸»é¢˜æŠ¥å‘Š
    ReportType.DeepResearch.value: "generate_deep_research_prompt",     # æ·±åº¦ç ”ç©¶æŠ¥å‘Š
}
```

### 10.2 æç¤ºè¯æ—æ˜ å°„

```python
prompt_family_mapping = {
    PromptFamilyEnum.Default.value: PromptFamily,      # é»˜è®¤æç¤ºè¯æ—
    PromptFamilyEnum.Granite.value: GranitePromptFamily,   # Granite æç¤ºè¯æ—
    PromptFamilyEnum.Granite3.value: Granite3PromptFamily, # Granite 3 æç¤ºè¯æ—
    PromptFamilyEnum.Granite31.value: Granite3PromptFamily, # Granite 3.1 æç¤ºè¯æ—
    PromptFamilyEnum.Granite32.value: Granite3PromptFamily, # Granite 3.2 æç¤ºè¯æ—
    PromptFamilyEnum.Granite33.value: Granite33PromptFamily, # Granite 3.3 æç¤ºè¯æ—
}
```

## æ€»ç»“

GPT Researcher é¡¹ç›®çš„æç¤ºè¯ç³»ç»Ÿè®¾è®¡å¾—éå¸¸å…¨é¢å’Œçµæ´»ï¼Œæ¶µç›–äº†ï¼š

1. **å¤šç§æŠ¥å‘Šç±»å‹**ï¼šç ”ç©¶æŠ¥å‘Šã€èµ„æºæŠ¥å‘Šã€å¤§çº²æŠ¥å‘Šã€è‡ªå®šä¹‰æŠ¥å‘Šã€å­ä¸»é¢˜æŠ¥å‘Šã€æ·±åº¦ç ”ç©¶æŠ¥å‘Š
2. **MCP é›†æˆ**ï¼šæ”¯æŒ Model Context Protocol çš„å·¥å…·é€‰æ‹©å’Œç ”ç©¶æ‰§è¡Œ
3. **è¯¦ç»†æŠ¥å‘Šç”Ÿæˆ**ï¼šåŒ…æ‹¬å­ä¸»é¢˜è§„åˆ’ã€å†…å®¹å”¯ä¸€æ€§ä¿è¯ã€ç»“æ„åŒ–æ ¼å¼åŒ–
4. **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ‰€æœ‰æŠ¥å‘Šéƒ½æ”¯æŒå¤šè¯­è¨€ç”Ÿæˆ
5. **å¤šç§æ ¼å¼æ”¯æŒ**ï¼šAPA ç­‰å­¦æœ¯å¼•ç”¨æ ¼å¼
6. **æ¨¡å‹é€‚é…**ï¼šé’ˆå¯¹ä¸åŒæ¨¡å‹ï¼ˆå¦‚ IBM Graniteï¼‰çš„ç‰¹å®šæ ¼å¼ä¼˜åŒ–
7. **æºç®¡ç†**ï¼šæ™ºèƒ½çš„æºé€‰æ‹©å’Œæ•´ç†ç³»ç»Ÿ

è¿™ä¸ªæç¤ºè¯ç³»ç»Ÿä¸º GPT Researcher æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ç ”ç©¶èƒ½åŠ›ï¼Œèƒ½å¤Ÿé€‚åº”å„ç§ç ”ç©¶éœ€æ±‚å’ŒæŠ¥å‘Šç±»å‹ã€‚